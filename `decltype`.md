–ö–æ—Ä–æ—Ç–∫–æ, –Ω–æ –≥–ª—É–±–æ–∫–æ.

---

# `decltype`

`decltype(expr)` ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± **–ø–æ–ª—É—á–∏—Ç—å —Ç–∏–ø –≤—ã—Ä–∞–∂–µ–Ω–∏—è `expr` –≤–æ –≤—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏**.

–û–Ω **–Ω–∏—á–µ–≥–æ –Ω–µ –≤—ã—á–∏—Å–ª—è–µ—Ç**, —Ç–æ–ª—å–∫–æ –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–∏–ø.

---

## –ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä

```cpp
int x = 5;
decltype(x) y = 10;  // y –∏–º–µ–µ—Ç —Ç–∏–ø int
```

---

## –ì–ª–∞–≤–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ –æ—Ç `auto`

```cpp
int x = 5;

auto a = x;        // int
decltype(x) b = x; // int
```

–ù–æ:

```cpp
int& ref = x;

auto a = ref;        // int  (—Å—Å—ã–ª–∫–∞ —Ç–µ—Ä—è–µ—Ç—Å—è)
decltype(ref) b = x; // int& (—Å—Å—ã–ª–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è)
```

üëâ `decltype` **—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ—á–Ω—ã–π —Ç–∏–ø**, –≤–∫–ª—é—á–∞—è `&` –∏ `const`.

---

## –ü–æ–≤–µ–¥–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ñ–æ—Ä–º—ã –≤—ã—Ä–∞–∂–µ–Ω–∏—è

### 1Ô∏è‚É£ –ü—Ä–æ—Å—Ç–æ –∏–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π

```cpp
int x;
decltype(x) a; // int
```

---

### 2Ô∏è‚É£ –í—ã—Ä–∞–∂–µ–Ω–∏–µ –≤ —Å–∫–æ–±–∫–∞—Ö

```cpp
int x;
decltype((x)) a = x; // int& !!!
```

–ü–æ—á–µ–º—É?  
–ü–æ—Ç–æ–º—É —á—Ç–æ `(x)` ‚Äî —ç—Ç–æ lvalue-–≤—ã—Ä–∞–∂–µ–Ω–∏–µ.

–≠—Ç–æ –≤–∞–∂–Ω–æ.

---

## –° —Ñ—É–Ω–∫—Ü–∏—è–º–∏

```cpp
int foo();

decltype(foo()) x; // —Ç–∏–ø ‚Äî int
```

---

## –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å —à–∞–±–ª–æ–Ω–∞–º–∏

```cpp
template<typename T, typename U>
auto add(T a, U b) -> decltype(a + b) {
    return a + b;
}
```

–ó–¥–µ—Å—å:

- `decltype(a + b)` –≤—ã—á–∏—Å–ª—è–µ—Ç —Ç–æ—á–Ω—ã–π —Ç–∏–ø —Å—É–º–º—ã
    

---

## `decltype(auto)` (C++14)

–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å—Å—ã–ª–æ—á–Ω–æ—Å—Ç—å:

```cpp
int x = 5;

decltype(auto) f() {
    return (x); // –≤–µ—Ä–Ω—ë—Ç int&
}
```

---

## –ì–¥–µ —Ä–µ–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

- —à–∞–±–ª–æ–Ω—ã
    
- return-type-deduction
    
- —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –æ–±—ë—Ä—Ç–∫–∏
    
- perfect forwarding
    
- –≤—ã—Ä–∞–∂–µ–Ω–∏—è —Å `std::declval`
    

---

## –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ

```
auto     ‚Üí –≤—ã–≤–æ–¥ —Ç–∏–ø–∞, –º–æ–∂–µ—Ç —É–±—Ä–∞—Ç—å —Å—Å—ã–ª–∫—É
decltype ‚Üí —Ç–æ—á–Ω—ã–π —Ç–∏–ø –≤—ã—Ä–∞–∂–µ–Ω–∏—è
```

---

## –ú–∏–Ω–∏-—Ç–∞–±–ª–∏—Ü–∞

|–í—ã—Ä–∞–∂–µ–Ω–∏–µ|decltype|
|---|---|
|`x`|—Ç–∏–ø x|
|`(x)`|T& –µ—Å–ª–∏ x ‚Äî lvalue|
|`foo()`|—Ç–∏–ø –≤–æ–∑–≤—Ä–∞—Ç–∞|

---

## –û–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞

> `decltype` ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è **—Ç–æ—á–Ω–æ–≥–æ —Ç–∏–ø–∞ –≤—ã—Ä–∞–∂–µ–Ω–∏—è**,  
> –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–µ–Ω –≤ —à–∞–±–ª–æ–Ω–∞—Ö –∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å–æ —Å—Å—ã–ª–∫–∞–º–∏.

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –º–æ–∂–µ–º —Ä–∞–∑–æ–±—Ä–∞—Ç—å **–ø–æ—á–µ–º—É `(x)` –¥–∞—ë—Ç —Å—Å—ã–ª–∫—É –∏ –æ—Ç–∫—É–¥–∞ —ç—Ç–æ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–µ** ‚Äî —Ç–∞–º –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞ value categories.